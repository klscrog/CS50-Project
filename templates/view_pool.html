{% extends "layout.html" %}

{% block title %}
    View Pool
{% endblock %}

{% block main %}
    <h1>{{ pool.name }}</h1>
    <p>Grid Size: {{ pool.grid_size }} x {{ pool.grid_size }}</p>
    <table class="table table-bordered" id="poolTable">
        <tbody>
            {% for x in range(pool.grid_size) %}
            <tr>
                {% for y in range(pool.grid_size) %}
                <td>
                    {% if pool.squares[x][y] %}
                        {{ pool.squares[x][y] }}
                    {% else %}
                        <button class="btn btn-sm btn-primary" onclick="showPopup({{ pool.id }}, {{ x }}, {{ y }})">Claim</button>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="popup" id="popup" style="display: none;">
        <input type="text" id="name" placeholder="Enter your name">
        <button class="btn btn-sm btn-success" onclick="submitClaim()">Submit</button>
        <button class="btn btn-sm btn-secondary" onclick="hidePopup()">Cancel</button>
    </div>
    <div class="d-flex justify-content-center mt-3">
        <button id="generateNumbersBtn" class="btn btn-secondary" disabled>Generate Numbers</button>
    </div>
{% endblock %}

{% block scripts %}
<style>
    .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        border: 1px solid #ccc;
        background-color: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }
</style>
<script>
    let currentPoolId, currentX, currentY;

    function showPopup(poolId, x, y) {
        currentPoolId = poolId;
        currentX = x;
        currentY = y;
        const popup = document.getElementById('popup');
        popup.style.display = 'block';
    }

    function hidePopup() {
        const popup = document.getElementById('popup');
        popup.style.display = 'none';
    }

    function submitClaim() {
        const name = document.getElementById('name').value;
        if (name) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/claim_square/${currentPoolId}/${currentX}/${currentY}`;
            
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'name';
            input.value = name;
            form.appendChild(input);
            
            document.body.appendChild(form);
            form.submit();
        } else {
            alert('Please enter your name');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const squares = {{ pool.squares | tojson }};
        const gridSize = {{ pool.grid_size }};
        let allFilled = true;

        for (let x = 0; x < gridSize; x++) {
            for (let y = 0; y < gridSize; y++) {
                if (!squares[x][y]) {
                    allFilled = false;
                    break;
                }
            }
            if (!allFilled) break;
        }

        if (allFilled) {
            document.getElementById('generateNumbersBtn').disabled = false;
        }
    });
</script>
{% endblock %}

